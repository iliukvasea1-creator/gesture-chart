<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<title>Gesture Test iPhone</title>

<!-- iOS REQUIRED -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #0e0e0e;
  overflow: hidden;
}

#status {
  position: fixed;
  top: 10px;
  left: 10px;
  color: #4ade80;
  font-family: monospace;
  z-index: 10;
}

video {
  position: fixed;
  right: 10px;
  bottom: 10px;
  width: 140px;
  opacity: 0.3;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>

<body>

<div id="status">INITâ€¦</div>
<video id="video" autoplay playsinline></video>

<script>
const status = document.getElementById('status')
const video = document.getElementById('video')

status.innerText = 'LOADING MEDIAPIPEâ€¦'

// ===== MEDIAPIPE HANDS =====
const hands = new Hands({
  locateFile: f =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
})

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.6,
  minTrackingConfidence: 0.6
})

hands.onResults(res => {
  if (!res.multiHandLandmarks) {
    status.innerText = 'NO HAND'
    return
  }

  const lm = res.multiHandLandmarks[0]

  const thumb = lm[4]
  const index = lm[8]

  const pinch = Math.hypot(
    thumb.x - index.x,
    thumb.y - index.y
  )

  if (pinch < 0.06) {
    status.innerText = 'ðŸ¤ PINCH'
  } else {
    status.innerText = 'âœ‹ HAND DETECTED'
  }
})

// ===== CAMERA =====
const camera = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video })
  },
  width: 640,
  height: 480,
  facingMode: 'user' // Ñ„Ñ€Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ°Ð¼ÐµÑ€Ð°
})

// iOS needs user interaction
document.body.addEventListener('click', () => {
  status.innerText = 'CAMERA STARTINGâ€¦'
  camera.start()
}, { once: true })

status.innerText = 'TAP SCREEN TO START CAMERA'
</script>

</body>
</html>
